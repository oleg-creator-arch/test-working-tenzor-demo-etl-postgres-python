# Общая информация

Проект содержит среду тестового задания для "живого кодинга" в ходе собеседования для разработки Python приложения.

Тестовые задания приведены в файле [./Задание.md](./Задание.md)

Суть приложения Python - регулярно снимать срез данных (строки как JSON массив) с источника Web-сервера, агрегировать их в статистики (суммировать) и фиксировать в БД. 

Базовый проект:
- Сервер приложений, который работает итерационно
- За итерацию выполняется:
  - Чтение данных из источника - Web API сервера, конкретного эндпоинта с передачей в запрос даты-время начала (включая) и окончания (не включая) временного периода
  - Обработка данных - приведение полученных строк-фактов к статистическим показаелям
  - Запись данных для записи в таблицу БД

Включает поднятие контейнера docker:
- docker-контейнер PostgreSQL

Нотация именования:

|Объект именования|Комментарий, описание|Пример|
|---|---|---|
|Файл с описанием классе|Начиная с большой буквы, включая новые слова, без подчёркивания|EmulatoreWebApi.js|
|Класс|Начиная с большой буквы, включая новые слова, без подчёркивания|EmulatoreWebApi|
|Объект, включая массив и данные JSON|Начиная с маленькой буквы, далее новые слова с большой буквы, без подчёркивания|emulatoreWebApi|
|Метод|Начиная с маленькой буквы, далее новые слова с большой буквы, без подчёркивания|getData|
|Константы и переменные|Те, которые не создаются явно через new (включая строки, числовые значения) и не являбтся структурой (массивом, объектом JSON и т.п.)\nC маленькой буквы, между словами подчёткивание|data_filename|

# Инициализация среды

## Среда работы с контейнерами

Установить docker, и docker-compose (если установленная версия docker не включает команду compose) - см [https://docs.docker.com/engine/install/](https://docs.docker.com/engine/install/)

## Расширения VSCode

В закладке Extensions установить стандартные расширения:
- Jest (vscode-jest, производитель Orta)
- Jest Runner (vscode-jest-runner, производитель firsttris)

## Библиотеки python

```bash
python3 -m venv ./venv
source ./venv/bin/activate

pip3 install -r requirements-test.txt
```

Используется:
 - flask - для эмулятора Web API сервера
 - pytest - для автотестов
 - requests - для HTTP запроса в рамках тестов
 - asyncpg - для взаимодействия с СУБД Postgres в рамках тестов

После завершения установки, VSCode необходимо закрыть и открыть - должна появится закладка Testing со списком автотестов.

# Запуск контейнера СУБД PostgreSQL

Для проверки автотестов с СУБД PostgreSQL запустить работу контейнера docker

```bash
cd ./docker
docker-compose --file ./dc-postgres.yml up -d
cd ./..
```

Контейнер запустится на порту хоста 20433 , с созданием внутри:
- БД demo_db
- Роль demo_role
- Схема demo_schema
- Таблица демо-данных demo_data
- Пользователь demo_user с паролем demo_pw

Данные БД размещаются в каталоге ./mnt

❗ При работе на linux может потребоваться каталог сделать заранее ./mnt/postgres и выдать на него права 777 для избежания проблем работы контейнера с хостовой файловой системой в данном каталоге.

По окончанию использования достаточно целиком удалить ./mnt/postgres


