# Тестовые задания

В среде проверяются тестовые задания для разработки на Python, и для SQL.
С базовыми заданиями для подготовки к "живому кодингу".

## Проверка разработки на Python

Суть проекта - сервер приложений, который регулярно минуту HTTP запросом забирает данные из HTTP сервера, и вставляет их в СУБД. Сам запуск можно вынести за пределы приложения.  

В запрос к источнику Web API передаётся время предыдущего успешно выполненного запроса и время выполнения текущего запроса (оно же должно сохраняться в файле) в формате epoch

Данные на стороне HTTP содержат метку времени в формате epoch, возвращается массив объектов с атрибутами:
- ts - время в формате epoch
- group_name - строковое название группы до 200 символов
- cnt - целочисленное не отрицательное значение

Полученные данные необходимо сгруппировать до name, cnt сложить, и вставить в таблицу БД PostgreSQL:
- from_ts - время начала периода
- to_ts - время окончания периода
- group_name - название группы
- cnt - сумма по cnt исходных строк

### Что есть на входе в проекте

Проект включает:
- Среда разработки, настроенная для VSCode (требуется согласно README установка расширений, библиотек для python), с настроенной средой выполнения автотестов
- Автотесты, включая пример (должен отработать успешно), и содержательные автотесты (при выполнении должны выдать ошибки из-за отсутствия функционала в основном классе).
- Основной класс - основа для сервера приложений с методами чтения / обработки / записи.
- Docker файл для поднятия docker контейнера с СУБД PostgreSQL (на основе публичного официального имиджа) для реализации / проверки работы с БД (с созданием пользователя, схемы и БД при первом запуске). 

Тесты реализованы с явным указанием подготовки начального тестового состояния и входящих данных, тестового вызова, проверки результата через сохранение данных в файл (во временный подкаталог ./tmp c идентификатором теста) и его сравнение с файлом ожидаемого ответа (для каждого теста свой). 

Тесты размещаются в ./python/tests , файлы для тестов размещаются в ./python/tests/resources по группе тестов.

Для тестирования работы с PostgreSQL предварительно необходимо стартовать docker контейнер с PostgreSQL (запуск и подключение к БД описаны в README). 

### Задания
​
❗ В автотестах используются вспомогательные методы, включающие работу с файлами, выполнение HTTP запроса, работу с СУБД PostgreSQL. Фрагменты этого кода могут быть реализованы "не для промышленного использования", а для целей автоматизированного тестирования (с обеспечением простоты использования, атомарности действий, достаточности для выполнения тестов группой или по отдельности как самостоятельных действий). Реализация тестовой среды предоставляется для снижения трудозатрат на выполнение задания и проверку его работоспособности. При выполнении задания тесты могут быть реализованы другим способом - но должны быть работоспособны. При реализации целевого кода ожидается реализация "промышленного" варианта, предназначенного для непосредственной работы в промышленной среде.

Доработать функционал, который приведёт к успешной работе уже созданных автотестов и добавлению новых актуальных тестов:
1. Добавить реализацию обращения к HTTP с получением ответа - считаем что данные в ответе менее 100KB. Только HTTP без какой-либо аутентификации
2. Добавить реализацию преобразования полученных данных в статистики
3. Добавить реализацию записи в БД - достаточно построчной, или пакетную
4. Добавить метод выполнения итерации целиком - с вызовом выполнения через вызов выполнения python приложения из командной строки 
5. Добавить вывод в консоль сообщений о ходе работы с человеко-читаемыми сообщениями, начиная с метки времени, в частности для событий: 
   - начало выполнения итерации
   - кол-во полученных строк или сообщение об ошибке подключения
   - кол-во вставленных строк или сообщение об ошибке
   - вывод сообщений об ошибке
   - завершение выполнения итерации
​
При реализации можно вносить любые изменения и использовать любые модули / библиотеки, с приведением обоснования их использования - либо ограничиться уже присутствующими в проекте.

Кроме самого кода для сервера ожидается добавление показательных автотестов и подготовка списка тестовых ситуаций, которые целесообразно реализовать для проверки каждого этапа работы сервера.

Оцениваться будет работоспособность реализации и тестов, покрытие автотестами, оформление исходного кода и автотестов - в ходе "живого кодинга" будет проверяться понимание кода и внесение в него изменений под новые требования по хожу встречи.

Выполнение задания ожидается в виде кода - файлов / методов целевого сервера и автотестов, сохранённых в подкаталоге ./python , с демонстрацией работы приложения через запуск автотестов и для выполнения полной итерации через запуск из командной строки:

```bash
export PYTHONPATH="${PYTHONPATH}:./python"
sh -c "cd ./python && python3 ./app.py"
```

## Проверка SQL

Проверка работа с SQL запросами - на docker-контейнере с PostgreSQL и тестовыми данными в таблице demo_schema.demo_data.

Таблица содержит данные с значениями метрик - за разные моменты времени, по 2м метрикам, по 2м разным группам (хостам).

Выполнение задания ожидается в виде готового SQL кода, который сохранён в каталоге ./sql , и может быть продемонстрирован в ходе встречи через запуск выполнения к текстовой БД - например из DBeaver.

### SQL#1

Выбрать по каждой метрике из справочника (для каждой группы), за период данные с  3мя наибольшими значениями метрики за выбранным период времени (или пустые значения если данных нет)

Для примера ограничение по времени ts >= '2025-01-01 10:00:00 +0300' and ts < '2025-01-01 11:00:00 +0300'

### SQL#2

Выбрать данные за период, опционально с фильтром по названию группы (колонка group_name - может быть задана или пустая строка), сгруппированные по метрике и группе по часу суток с учётом временной зоны (из Grafana - 'Europe/Moscow'), с статистикой сумма от метрике и группе. Независимо от наличия данных по каждой паре группа + метрика (по которой есть хотя бы одно значение) должна быть выведена строка на каждый час суток (если данных нет - значение null)

Ограничение времени для примера ts >= '2025-01-01 10:00:00 +0300' and ts < '2025-01-02 10:00:00 +0300'

Группы подставляются как фрагмент строки при генерации SQL запроса - 1) ничего "", 2) одно значение "'host-2'", 3) несколько значений "'host-1', 'host-2'"

### SQL#3

Из минутных значений метрик (могут быть пропуски - т.е. данные не за каждую минуту) рассчитать таблицу с инкрементом между текущим и предыдущим часом на момент, наиболее близкий к началу календарного часа

На примере host-2 метрике ram

### SQL#4

Выбрать данные по группе за период времени, с добавлением показателей (статистик) - минимального значения по группе и максимального значения по группе за календарные сутки с учётом заданной временной зоны (из Grafana 'Europe/Moscow')
